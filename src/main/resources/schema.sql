CREATE TABLE IF NOT EXISTS USERS (
    user_id     INT             GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    email       VARCHAR(30)     NOT NULL,
    login       VARCHAR(20)     NOT NULL,
    name        VARCHAR(20)     NOT NULL,
    birthday    DATE            NOT NULL
);

CREATE TABLE IF NOT EXISTS FILMS (
    film_id         INT             GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name            VARCHAR(50)     NOT NULL,
    description     VARCHAR(255)    NOT NULL,
    release_date    DATE            NOT NULL,
    duration        INT             NOT NULL,
    rate            FLOAT           NOT NULL,
    mpa_id          INT             NOT NULL
);


CREATE TABLE IF NOT EXISTS USER_FRIENDS (
    user_friends_id     INT     GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    user_id             INT     NOT NULL,
    friend_id           INT     NOT NULL,
    status              INT     NOT NULL,
    CONSTRAINT USER_FRIENDS_USER_FK FOREIGN KEY (user_id) REFERENCES USERS
    ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT USER_FRIENDS_FRIEND_FK FOREIGN KEY (friend_id) REFERENCES USERS
    ON DELETE CASCADE ON UPDATE CASCADE
);


CREATE TABLE IF NOT EXISTS APPRAISERS (
    appraiser_id    INT     GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    user_id         INT     NOT NULL,
    film_id         INT     NOT NULL,
    CONSTRAINT APPRAISERS_USER_FK FOREIGN KEY (user_id) REFERENCES USERS
    ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT APPRAISERS_FILM_FK FOREIGN KEY (film_id) REFERENCES FILMS
    ON DELETE CASCADE ON UPDATE CASCADE
);



CREATE TABLE IF NOT EXISTS GENRES (
    genre_id    INT         GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name        VARCHAR(20) NOT NULL
);

CREATE TABLE IF NOT EXISTS MOTION_PICTURE_ASSOCIATIONS (
    mpa_id    INT           GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name      VARCHAR(5)   NOT NULL
);


CREATE TABLE IF NOT EXISTS FILM_GENRES (
    film_genre_id   INT     GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    film_id         INT     NOT NULL,
    genre_id        INT     NOT NULL,
    CONSTRAINT FILM_GENRES_FILM_FK FOREIGN KEY (film_id) REFERENCES FILMS
    ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT FILM_GENRES_GENRE_FK FOREIGN KEY (genre_id) REFERENCES GENRES
    ON DELETE CASCADE ON UPDATE CASCADE
);